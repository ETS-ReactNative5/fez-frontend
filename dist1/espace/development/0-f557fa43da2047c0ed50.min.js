webpackJsonp([0],{1410:function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},s=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),c=o(0),u=i(c),d=o(1),f=i(d),p=o(25),m=o(47),h=i(m),b=o(94),g=i(b),v=o(14),_=o(144),y=o(13),x=function(e){function t(e){r(this,t);var o=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o.isLoggedInUserLinked=function(e,t,o,i){return t[o]&&t[o].length>0&&t[o].filter(function(t){return t[i]===e.aut_id}).length>0},o._navigateToMyResearch=function(){o.props.history.push(y.routes.pathConfig.records.mine)},o._navigateToDashboard=function(){o.props.history.push(y.routes.pathConfig.dashboard)},o._actionSelected=function(e,t){o.setState({selectedRecordAction:t})},o._handleKeyboardFormSubmit=function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),o.props.handleSubmit())},o.getAlert=function(e){var t=e.submitFailed,o=void 0!==t&&t,i=e.dirty,r=void 0!==i&&i,n=e.invalid,a=void 0!==n&&n,s=e.submitting,c=void 0!==s&&s,d=e.error,f=e.submitSucceeded,p=void 0!==f&&f,m=e.alertLocale,h=void 0===m?{}:m,b=null;return o&&d?b=l({},h.errorAlert,{message:h.errorAlert.message?h.errorAlert.message(d):d}):!o&&r&&a?b=l({},h.validationAlert):c?b=l({},h.progressAlert):p&&(b=l({},h.successAlert)),b?u.default.createElement(v.Alert,b):null},o._setSuccessConfirmation=function(e){o.successConfirmationBox=e},o.state={selectedRecordAction:""},o}return a(t,e),s(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.recordToFix,o=e.author,i=o&&t&&this.isLoggedInUserLinked(o,t,"fez_record_search_key_author_id","rek_author_id"),r=o&&t&&this.isLoggedInUserLinked(o,t,"fez_record_search_key_contributor_id","rek_contributor_id");this.props.authorLoading||this.props.recordToFixLoading||i||r||this.props.history.go(-1)}},{key:"componentDidMount",value:function(){this.props.recordToFixLoading||this.props.recordToFix||this.props.actions.loadRecordToFix(this.props.match.params.pid),this.props.authorLoading||this.props.author||this.props.actions.loadCurrentAccount()}},{key:"componentWillReceiveProps",value:function(e){e.submitSucceeded!==this.props.submitSucceeded&&this.successConfirmationBox.showConfirmation()}},{key:"componentWillUnmount",value:function(){this.props.actions.clearFixRecord()}},{key:"render",value:function(){var e=y.locale.pages.fixRecord,t=y.locale.forms.fixPublicationForm,o=y.locale.forms.unclaimPublicationForm;if(this.props.authorLoading||this.props.recordToFixLoading)return u.default.createElement("div",{className:"is-centered"},u.default.createElement(v.InlineLoader,{message:e.loadingMessage}));var i=this.props,r=i.recordToFix,n=i.author;if(!r||!n)return u.default.createElement("div",null);var a=e.actionsOptions.map(function(e,t){return u.default.createElement(g.default,{value:e.action,primaryText:e.title,key:"fix_record_action_"+t})}),s=l({},t.successWorkflowConfirmation);return this.props.publicationToFixFileUploadingError&&(s.confirmationMessage=s.fileFailConfirmationMessage),u.default.createElement(v.StandardPage,{title:e.title},u.default.createElement("form",{onKeyDown:this._handleKeyboardFormSubmit},u.default.createElement(v.StandardCard,{title:e.subTitle,help:e.help},u.default.createElement(_.PublicationCitation,{publication:r}),u.default.createElement(p.Field,l({component:v.SelectField,disabled:this.props.submitting,name:"fixAction"},this.context.selectFieldMobileOverrides,{floatingLabelText:e.fieldLabels.action,validate:[y.validation.required],onChange:this._actionSelected,className:"requiredField"}),a)),"fix"===this.state.selectedRecordAction&&u.default.createElement("div",null,u.default.createElement(v.NavigationDialogBox,{when:this.props.dirty&&!this.props.submitSucceeded,txt:t.cancelWorkflowConfirmation}),u.default.createElement(v.ConfirmDialogBox,{onRef:this._setSuccessConfirmation,onAction:this._navigateToMyResearch,onCancelAction:this._navigateToDashboard,locale:s}),u.default.createElement(v.StandardCard,{title:t.comments.title,help:t.comments.help},u.default.createElement(p.Field,{component:v.TextField,className:"requiredField",disabled:this.props.submitting,name:"comments",type:"text",fullWidth:!0,multiLine:!0,rows:1,floatingLabelText:t.comments.fieldLabels.comments,validate:[y.validation.required]}),u.default.createElement(p.Field,{component:v.TextField,disabled:this.props.submitting,name:"rek_link",type:"text",fullWidth:!0,floatingLabelText:t.comments.fieldLabels.url,validate:[y.validation.url]})),u.default.createElement(v.StandardCard,{title:t.fileUpload.title,help:t.fileUpload.help},t.fileUpload.description,u.default.createElement(p.Field,{name:"files",component:v.FileUploadField,disabled:this.props.submitting,requireFileAccess:!0,validate:[y.validation.validFileUpload]}))),"unclaim"===this.state.selectedRecordAction&&u.default.createElement(v.StandardCard,{title:o.title,help:o.help},u.default.createElement(v.Alert,o.alert),o.description,u.default.createElement(v.ConfirmDialogBox,{onRef:this._setSuccessConfirmation,onAction:this._navigateToMyResearch,onCancelAction:this._navigateToDashboard,locale:o.successWorkflowConfirmation})),this.getAlert(l({},this.props,{alertLocale:t})),u.default.createElement("div",{className:"columns action-buttons"},u.default.createElement("div",{className:"column is-hidden-mobile"}),u.default.createElement("div",{className:"column is-narrow-desktop"},u.default.createElement(h.default,{fullWidth:!0,label:e.cancel,disabled:this.props.submitting,onTouchTap:this._navigateToMyResearch})),this.state.selectedRecordAction&&u.default.createElement("div",{className:"column is-narrow-desktop"},u.default.createElement(h.default,{secondary:!0,fullWidth:!0,label:e.submit,onTouchTap:this.props.handleSubmit,disabled:this.props.submitting||this.props.invalid})))))}}]),t}(c.Component);x.propTypes=l({},p.propTypes,{recordToFix:f.default.object,recordToFixLoading:f.default.bool,author:f.default.object,authorLoading:f.default.bool,history:f.default.object.isRequired,match:f.default.object.isRequired,actions:f.default.object.isRequired}),x.contextTypes={selectFieldMobileOverrides:f.default.object},t.default=x},1411:function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=o(1412);Object.defineProperty(t,"FixRecord",{enumerable:!0,get:function(){return i(r).default}})},1412:function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){return{actions:(0,l.bindActionCreators)(h,e)}}Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},a=o(18),l=o(46),s=o(25),c=o(41),u=i(c),d=o(1410),f=i(d),p=o(61),m=o(42),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}(m),b=o(424),g=function(e,t,o){var i=n({},e.toJS(),{publication:n({},o.recordToFix),author:n({},o.author)});return t("unclaim"===i.fixAction?h.unclaimRecord(i):h.fixRecord(i)).then(function(){}).catch(function(e){throw new s.SubmissionError({_error:e.message})})},v=function(){(0,s.stopSubmit)("FixRecord",null)},_=(0,s.reduxForm)({form:"FixRecord",validate:v,onSubmit:g})((0,b.confirmDiscardFormChanges)(f.default,"FixRecord")),y=function(e){return n({},e.get("fixRecordReducer"),e.get("accountReducer"),{formValues:(0,s.getFormValues)("FixRecord")(e)||u.default.Map({})})};_=(0,a.connect)(y,r)(_),_=(0,p.withRouter)(_),t.default=_}});
//# sourceMappingURL=0-f557fa43da2047c0ed50.min.js.map